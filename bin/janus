#!/usr/bin/env php
<?php

/**
 * This runs the Terminus installer. It does the following:
 *    - Includes the Composer autoload file
 *    - Starts a container with input, output, and application objectss
 *    - Searches for and loads commands
 *    - Runs the command
 *    - Exits with a status code
 */

// Include the Composer autoload file
$phar_path = \Phar::running(true);
if ($phar_path) {
    include_once "$phar_path/vendor/autoload.php";
} else {
    if (file_exists(__DIR__ . '/../vendor/autoload.php')) {
        include_once __DIR__ . '/../vendor/autoload.php';
    } elseif (file_exists(__DIR__ . '/../../../autoload.php')) {
        include_once __DIR__ . '/../../../autoload.php';
    }
}

// Starring
use Robo\Robo;
use Robo\Runner;
use Symfony\Component\Console\Application;
use Symfony\Component\Console\Input\ArgvInput;
use Symfony\Component\Console\Output\ConsoleOutput;

// Running Terminus Installer
$input = new ArgvInput(array_merge([$_SERVER['argv'][0],], ['install'], array_splice($_SERVER['argv'], 1)));
$output = new ConsoleOutput();
$runner = new Runner(Robo::createDefaultContainer($input, $output, new Application('Terminus Installer', '0.0.1')));
$command = [__DIR__ . '/../src/Commands/InstallCommand.php' => 'Pantheon\Janus\Commands\InstallCommand',];
$status_code = $runner->run($input, $output, null, $command);
exit($status_code);
